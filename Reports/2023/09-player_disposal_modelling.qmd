---
title: "Player Disposals Modelling"
execute:
  echo: false
  message: false
  warning: false
author: "James Brown"
date: "2023-03-23"
format:
  html:
    df-print: kable
    theme: cosmo
    self-contained: true
    toc: true
    toc-depth: 3
    fig-width: 8
    fig-height: 6
editor: visual
---

```{r}
# Libraries and functions
library(tidyverse)
library(qreport)

# Load data processing functions
source("../../Functions/data_processing_functions.R")

# Get current season data
current_season_data <-
  get_fantasy_data(season = lubridate::year(Sys.Date()))

# Historical
prev_season_data <- readr::read_rds("../../Data/afl_fantasy_2014_2022_data.rds")
  
# Combine to get total
player_history <- dplyr::bind_rows(current_season_data, prev_season_data)
```

## Disposal by team

First, look at which teams give up the most disposals to opposition players

```{r}
#| tbl-colwidths: true
#| column: screen
# Overall
disposals_by_match <-
current_season_data |> 
  group_by(match_name, round, venue) |> 
  summarise(total_disposals = sum(disposals)) |> 
  arrange(desc(total_disposals))

# Get disposals per venue
disposals_by_venue <-
disposals_by_match |>
  group_by(venue) |>
  summarise(avg_disposals = mean(total_disposals)) |>
  arrange(desc(avg_disposals))

# Disposals by round
disposals_by_match |>
  group_by(round) |>
  summarise(avg_disposals = mean(total_disposals)) |>
  arrange(as.integer(str_extract(round, "\\d+")))


```

